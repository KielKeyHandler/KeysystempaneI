<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Garcia's Script | Generate Key</title>

<style>
body {
    background:#0b0b0b;
    font-family:Arial, sans-serif;
    color:white;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    margin:0;
}
.card {
    width:480px;
    max-width:90%;
    background:#111;
    border-radius:18px;
    padding:35px;
    text-align:center;
}
.top {
    height:6px;
    background:#a678ff;
    border-radius:12px;
    margin-bottom:20px;
}
.logo {
    width:120px;
    margin-bottom:15px;
}
.keybox {
    background:#0f0f0f;
    padding:18px;
    border-radius:10px;
    font-size:16px;
    word-break:break-all;
    user-select:all;
    margin-bottom:15px;
}
button {
    width:100%;
    padding:16px;
    border:none;
    border-radius:10px;
    font-weight:bold;
    cursor:pointer;
    font-size:16px;
    margin-bottom:10px;
}
.copy {
    background:#3ddfff;
    color:black;
    display:none;
}
.info {
    font-size:14px;
    color:#aaa;
    margin-top:10px;
}
</style>
</head>

<body>
<div class="card">
    <div class="top"></div>

    <img class="logo" src="https://raw.githubusercontent.com/kielsvu/Utility/Lua/Utility/Icons/1763776738233.jpg">
    <h2>Garcia's Script</h2>
    <div class="info">Key valid for 12 hours</div>

    <div class="keybox" id="keyBox">Loading keyâ€¦</div>
    <button class="copy" onclick="copyKey()" id="copyBtn">COPY KEY</button>
</div>

<script>
const EXPIRY_TIME = 12 * 60 * 60 * 1000; // 12 hours
const keysUrl = "https://raw.githubusercontent.com/kielsvu/Utility/refs/heads/Lua/Utility/Major/Main.txt";

// Copy key to clipboard
function copyKey(){
    const key = document.getElementById("keyBox").innerText;
    navigator.clipboard.writeText(key);
    alert("Key copied to clipboard!");
}

// Save key with expiration in localStorage
function saveUsedKey(key){
    let usedKeys = JSON.parse(localStorage.getItem("GS_USED") || "{}");
    usedKeys[key] = Date.now() + EXPIRY_TIME;
    localStorage.setItem("GS_USED", JSON.stringify(usedKeys));
}

// Clean expired keys
function cleanExpiredKeys(){
    let usedKeys = JSON.parse(localStorage.getItem("GS_USED") || "{}");
    const now = Date.now();
    for(const k in usedKeys){
        if(usedKeys[k] <= now){
            delete usedKeys[k];
        }
    }
    localStorage.setItem("GS_USED", JSON.stringify(usedKeys));
    return usedKeys;
}

// Fetch keys from GitHub and pick a random available key
async function pickRandomKey(){
    cleanExpiredKeys();
    const res = await fetch(keysUrl + "?cache_bust=" + Date.now());
    const text = await res.text();
    const allKeys = text.split(/\s+/).filter(k => k.trim().length > 0);

    const usedKeys = JSON.parse(localStorage.getItem("GS_USED") || "{}");
    const availableKeys = allKeys.filter(k => !usedKeys[k]);

    if(availableKeys.length === 0){
        document.getElementById("keyBox").innerText = "No keys available. Try again later.";
        return;
    }

    const choice = availableKeys[Math.floor(Math.random() * availableKeys.length)];
    document.getElementById("keyBox").innerText = choice;
    document.getElementById("copyBtn").style.display = "block";

    saveUsedKey(choice);
}

// Check if there is a currently valid key in localStorage
function displaySavedKey(){
    cleanExpiredKeys();
    const usedKeys = JSON.parse(localStorage.getItem("GS_USED") || "{}");
    const now = Date.now();
    for(const k in usedKeys){
        if(usedKeys[k] > now){
            document.getElementById("keyBox").innerText = k;
            document.getElementById("copyBtn").style.display = "block";
            return true;
        }
    }
    return false;
}

// On page load
if(!displaySavedKey()){
    pickRandomKey();
}
</script>
</body>
</html>
